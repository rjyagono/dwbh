!function(t,e,a,n){t.extend(t.fn,{accrue:function(e){return e=t.extend({calculationMethod:o},t.fn.accrue.options,e),this.each(function(){var a=t(this);a.find(".form").length||a.append('<div class="form"></div>');r(a,e,"amount"),r(a,e,"rate"),r(a,e,"term");if("compare"==e.mode){r(a,e,"rate_compare")}var n;".results"===e.response_output_div?(0===a.find(".results").length&&a.append('<div class="results"></div>'),n=a.find(".results")):n=t(e.response_output_div);var m;switch(e.mode){case"basic":m=o;break;case"compare":m=l;break;case"amortization":m=s}m(a,e,n),"button"==e.operation?(0===a.find("button").length&&a.find(".form").append('<button class="accrue-calculate">'+e.button_label+"</button>"),a.find("button, input[type=submit]").each(function(){t(this).click(function(t){t.preventDefault(),m(a,e,n)})})):a.find("input, select").each(function(){t(this).bind("keyup change",function(){m(a,e,n)})}),a.find("form").each(function(){t(this).submit(function(t){t.preventDefault(),m(a,e,n)})})})}}),t.fn.accrue.options={mode:"basic",operation:"keyup",default_values:{amount:"P10,000",rate:"5%",rate_compare:"1.49%",term:"3m"},field_titles:{amount:"Loan Amount",rate:"Interest Rate",rate_compare:"Comparison Rate",term:"Term"},button_label:"Calculate",field_comments:{amount:"",rate:"",rate_compare:"",term:"Format: 12m, 36m, 3y, 7y"},response_output_div:".results",response_basic:'<p style="display:none"><strong>Monthly Payment:</strong><br />P%payment_amount%</p><p><strong>Number of Payments:</strong><br />%num_payments%</p><p><strong>Total Payments:</strong><br />P%total_payments%</p><p style="display:none"><strong>Total Interest:</strong><br />P%total_interest%</p>',response_compare:"Save P%savings% in interest!",error_text:"Please fill in all fields.",callback:function(t,e){}};var r=function(t,e,a){var n;return t.find(".accrue-"+a).length?n=t.find(".accrue-"+a):t.find("."+a).length?n=t.find("."+a):t.find("input[name~="+a+"]").length?t.find("input[name~="+a+"]"):n="","string"!=typeof n?n.val():"term_compare"==a?!1:(t.find(".form").append('<div class="accrue-field-'+a+'"><p><label>'+e.field_titles[a]+':</label><input type="text" class="'+a+' form-control" value="'+e.default_values[a]+'" />'+(e.field_comments[a].length>0?"<small>"+e.field_comments[a]+"</small>":"")+"</p></div>"),t.find("."+a).val())},o=function(e,a,n){var o=t.loanInfo({amount:r(e,a,"amount"),rate:r(e,a,"rate"),term:r(e,a,"term")});if(0!==o){var l=a.response_basic.replace("%payment_amount%",o.payment_amount_formatted).replace("%num_payments%",o.num_payments).replace("%total_payments%",o.total_payments_formatted).replace("%total_interest%",o.total_interest_formatted);n.html(l)}else n.html('<p class="error">'+a.error_text+"</p>");a.callback(e,o)},l=function(e,a,n){var o=r(e,a,"term_compare");"boolean"==typeof o&&(o=r(e,a,"term"));var l=t.loanInfo({amount:r(e,a,"amount"),rate:r(e,a,"rate"),term:r(e,a,"term")}),s=t.loanInfo({amount:r(e,a,"amount"),rate:r(e,a,"rate_compare"),term:o}),m={loan_1:l,loan_2:s};if(0!==l&&0!==s){l.total_interest-s.total_interest>0?m.savings=l.total_interest-s.total_interest:m.savings=0;var c=a.response_compare.replace("%savings%",m.savings.toFixed(2)).replace("%loan_1_payment_amount%",s.payment_amount_formatted).replace("%loan_1_num_payments%",s.num_payments).replace("%loan_1_total_payments%",s.total_payments_formatted).replace("%loan_1_total_interest%",s.total_interest_formatted).replace("%loan_2_payment_amount%",l.payment_amount_formatted).replace("%loan_2_num_payments%",l.num_payments).replace("%loan_2_total_payments%",l.total_payments_formatted).replace("%loan_2_total_interest%",l.total_interest_formatted);n.html('<p class="total-savings">'+c+"</p>")}else n.html('<p class="error">'+a.error_text+"</p>");a.callback(e,m)},s=function(e,a,n){var o=t.loanInfo({amount:r(e,a,"amount"),rate:r(e,a,"rate"),term:r(e,a,"term")});if(0!==o){for(var l='<table class="accrue-amortization"><tr><th class="accrue-payment-number">#</th><th class="accrue-payment-amount">Payment Amt.</th><th class="accrue-total-interest">Total Interest</th><th class="accrue-total-payments">Total Payments</th><th class="accrue-balance">Balance</th></tr>',s=o.payment_amount-o.original_amount/o.num_payments,m=o.payment_amount-s,c=0,p=0,i=parseInt(o.original_amount),u=0;u<o.num_payments;u++){c+=s,p+=o.payment_amount,i-=m;var _="td";u==o.num_payments-1&&(_="th"),l=l+"<tr><"+_+' class="accrue-payment-number">'+(u+1)+"</"+_+"><"+_+' class="accrue-payment-amount">$'+o.payment_amount_formatted+"</"+_+"><"+_+' class="accrue-total-interest">$'+c.toFixed(2)+"</"+_+"><"+_+' class="accrue-total-payments">$'+p.toFixed(2)+"</"+_+"><"+_+' class="accrue-balance">$'+i.toFixed(2)+"</"+_+"></tr>"}l+="</table>",n.html(l)}else n.html('<p class="error">'+a.error_text+"</p>");a.callback(e,o)};t.loanInfo=function(t){var e=("undefined"!=typeof t.amount?t.amount:0).replace(/[^\d.]/gi,""),a=("undefined"!=typeof t.rate?t.rate:0).replace(/[^\d.]/gi,""),n="undefined"!=typeof t.term?t.term:0;n=n.match("y")?12*parseInt(n.replace(/[^\d.]/gi,"")):parseInt(n.replace(/[^\d.]/gi,""));var r=a/100,o=parseInt(e)*parseFloat(r)*n,l=(parseFloat(e)+parseFloat(o))/n;return e*a*n>0?{original_amount:e,payment_amount:l,payment_amount_formatted:l.toFixed(2),num_payments:n,total_payments:l*n,total_payments_formatted:(l*n).toFixed(2),total_interest:l*n-e,total_interest_formatted:(l*n-e).toFixed(2)}:0}}(jQuery,window,document);